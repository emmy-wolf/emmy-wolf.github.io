<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reverse Wordle Phone Guess</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
      background-color: lightblue;
    }
    h4 {
        width: 80%;             /* Set the desired width */ 
        padding-bottom: 3%;
        margin: auto;         /* Center the element horizontally */ 
        text-align: center;     /* Optional: Center the text within the element */
    }
    #random-number {
      display: flex;
      gap: 3rem;
      justify-content: center;
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }
    .guess-digit {
      width: 2.5rem;
      height: 2.5rem;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      font-weight: bold;
      color: white;
      background-color: #787c7e; /* default background so text is visible */
      border-radius: 0.4rem;
    }
    .guess-row {
      display: flex;
      margin: 0.5rem 0;
    }
    .guess-box {
      width: 2.5rem;
      height: 2.5rem;
      margin: 0.2rem;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.5rem;
      font-weight: bold;
      border-radius: 0.4rem;
      color: white;
    }
    .green { background-color: #6aaa64; }
    .yellow { background-color: #c9b458; }
    .gray { background-color: #787c7e; }
    .feedback-row {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    .feedback-select {
      width: 5rem;
      font-size: 1rem;
    }
    .feedback-box {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .feedback-box select.green {
      background-color: #6aaa64;
      color: white;
    }
    .feedback-box select.yellow {
      background-color: #c9b458;
      color: white;
    }
    .feedback-box select.gray {
      background-color: #787c7e;
      color: white;
    }
  </style>
</head>
<body>
  <h1>Reverse Wordle Phone Guess</h1>
  <h4>
    The Phone Number Wordle Bot is going to try to guess your phone number! 
    Help it out by marking which digits are in the correct location (green),
    which ones are in your phone number but in the wrong spot (yellow), or 
    if the digit doesn't appear in the phone number at all (gray).
  </h4>
  <div id="random-number"></div>
  <div class="feedback-row" id="feedback-controls"></div>
  <button id="submit-feedback">Submit Feedback</button>
  <div id="guess-history"></div>
  <h2 id="final-output"></h2>

  <script>
    let attempts = [];
    let knownGreens = Array(10).fill(null);
    let knownYellows = [];
    let knownGrays = new Set();

    function generateSmarterGuess() {
      let guess = '';
      const usedPositions = new Set();

      for (let i = 0; i < 10; i++) {
        if (knownGreens[i] !== null) {
          guess += knownGreens[i];
          usedPositions.add(i);
        } else {
          let digit;
          do {
            digit = Math.floor(Math.random() * 10).toString();
          } while (
            knownGrays.has(digit) ||
            (knownYellows.some(y => y.digit === digit && y.position === i))
          );
          guess += digit;
        }
      }

      if (attempts.includes(guess)) return generateSmarterGuess();
      return guess;
    }

    function displayRandomNumber(number, feedbackArray = []) {
      const container = document.getElementById("random-number");
      container.innerHTML = '';

      const feedbackControls = document.getElementById("feedback-controls");
      feedbackControls.innerHTML = '';

      for (let i = 0; i < 10; i++) {
        const span = document.createElement("span");
        span.className = "guess-digit";
        span.textContent = number[i];

        // Add color only if digit is known green or feedback explicitly given
        if (knownGreens[i] === number[i]) {
          span.classList.add("green");
        }

        container.appendChild(span);

        const feedbackBox = document.createElement("div");
        feedbackBox.className = "feedback-box";

        const select = document.createElement("select");
        select.className = "feedback-select";
        select.dataset.index = i;

        ["Gray", "Yellow", "Green"].forEach(color => {
          const option = document.createElement("option");
          option.value = color;
          option.textContent = color;
          if (knownGreens[i] !== null && color === "Green") {
            option.selected = true;
            select.classList.add("green");
          }
          select.appendChild(option);
        });

        select.addEventListener("change", function () {
          this.classList.remove("green", "yellow", "gray");
          this.classList.add(this.value.toLowerCase());
        });

        feedbackBox.appendChild(select);
        feedbackControls.appendChild(feedbackBox);
      }
    }

    function addGuessToHistory(guess, feedbackArray) {
      const historyContainer = document.getElementById("guess-history");
      const row = document.createElement("div");
      row.className = "guess-row";

      for (let i = 0; i < guess.length; i++) {
        const box = document.createElement("div");
        box.textContent = guess[i];
        box.className = `guess-box ${feedbackArray[i].toLowerCase()}`;
        row.appendChild(box);
      }

      historyContainer.appendChild(row);
    }

    function handleSubmitFeedback() {
      const lastAttempt = Array.from(document.querySelectorAll(".guess-digit"))
        .map(span => span.textContent)
        .join("");
      const selects = document.querySelectorAll(".feedback-select");
      const feedbackArray = [];

      selects.forEach((select, i) => {
        const color = select.value;
        feedbackArray[i] = color;

        const digit = lastAttempt[i];
        if (color === "Green") {
          knownGreens[i] = digit;
        } else if (color === "Yellow") {
          knownYellows.push({ digit, position: i });
        } else if (color === "Gray") {
          if (!knownGreens.includes(digit) &&
              !knownYellows.some(y => y.digit === digit)) {
            knownGrays.add(digit);
          }
        }
      });

      addGuessToHistory(lastAttempt, feedbackArray);
      attempts.push(lastAttempt);

      if (knownGreens.every(d => d !== null)) {
        document.getElementById("final-output").textContent = `Success! Your phone number is ${knownGreens.join('')}`;
      } else {
        const nextGuess = generateSmarterGuess();
        displayRandomNumber(nextGuess);
      }
    }

    document.getElementById("submit-feedback").addEventListener("click", handleSubmitFeedback);
    displayRandomNumber(generateSmarterGuess());
  </script>
</body>
</html>
